generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  schemas  = ["ecommerce"]
}

model Collection {
  id        Int                 @id @default(autoincrement())
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt
  slug      String              @unique
  name      String              @db.VarChar(255)
  parentId  Int?
  types     CollectionType[]
  useYn     Boolean             @default(true)
  parent    Collection?         @relation("ParentChild", fields: [parentId], references: [id])
  children  Collection[]        @relation("ParentChild")
  products  ProductCollection[]

  @@schema("ecommerce")
}

model Product {
  id            Int                 @id @default(autoincrement())
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  description   String
  published     Boolean             @default(false)
  price         Float
  rate          Float
  colors        ProductColor[]
  name          String              @db.VarChar(255)
  types         CollectionType[]
  originalPrice Float?
  banners       Banner[]
  flashSales    FlashSale[]
  attributes    ProductAttribute[]
  collections   ProductCollection[]
  images        ProductImage[]
  inclusions    ProductInclusion[]
  reviews       ProductReview[]
  cartItems     CartItem[]
  wishlistItems WishlistItem[]
  orderItems    OrderItem[]

  @@schema("ecommerce")
}

model FlashSale {
  id         Int      @id @default(autoincrement())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  productId  Int
  salePrice  Float
  totalSlots Int
  soldSlots  Int      @default(0)
  endTime    DateTime
  active     Boolean  @default(true)
  badge      String?
  product    Product  @relation(fields: [productId], references: [id])

  @@schema("ecommerce")
}

model Banner {
  id          Int      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  title       String
  subtitle    String?
  discount    String?
  imageUrl    String
  linkUrl     String?
  bgColor     String   @default("bg-white")
  textColor   String   @default("text-black")
  buttonColor String   @default("bg-orange-500")
  type        String   @default("HERO")
  order       Int      @default(0)
  active      Boolean  @default(true)
  productId   Int?
  product     Product? @relation(fields: [productId], references: [id])

  @@schema("ecommerce")
}

model ProductImage {
  id        Int      @id @default(autoincrement())
  imageURL  String
  imageBlur String
  productId Int?
  Product   Product? @relation(fields: [productId], references: [id])

  @@schema("ecommerce")
}

model Account {
  id                       String  @id @default(cuid())
  userId                   String
  type                     String
  provider                 String
  providerAccountId        String
  refresh_token            String?
  access_token             String?
  expires_at               Int?
  refresh_token_expires_in Int?
  token_type               String?
  scope                    String?
  id_token                 String?
  session_state            String?
  oauth_token              String?
  oauth_token_secret       String?
  user                     User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@schema("ecommerce")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@schema("ecommerce")
}

model User {
  id            String         @id @default(cuid())
  name          String?
  email         String?        @unique
  emailVerified DateTime?
  image         String?
  password      String?
  role          Role           @default(USER)
  accounts      Account[]
  contexts      Context[]
  sessions      Session[]
  cartItems     CartItem[]
  wishlistItems WishlistItem[]
  orders        Order[]

  @@schema("ecommerce")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@schema("ecommerce")
}

model ProductAttribute {
  id             Int      @id @default(autoincrement())
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  attributeName  String   @db.VarChar(255)
  attributeValue String
  productId      Int
  groupName      String?  @db.VarChar(255)
  product        Product  @relation(fields: [productId], references: [id])

  @@schema("ecommerce")
}

model ProductReview {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userName  String   @db.VarChar(255)
  rating    Int      @default(5)
  comment   String
  productId Int
  product   Product  @relation(fields: [productId], references: [id])

  @@schema("ecommerce")
}

model ProductInclusion {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  itemName  String   @db.VarChar(255)
  productId Int
  product   Product  @relation(fields: [productId], references: [id])

  @@schema("ecommerce")
}

model ProductCollection {
  productId    Int
  collectionId Int
  collection   Collection @relation(fields: [collectionId], references: [id])
  product      Product    @relation(fields: [productId], references: [id])

  @@id([productId, collectionId])
  @@schema("ecommerce")
}

model Context {
  id        Int         @id @default(autoincrement())
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  title     String      @db.VarChar(255)
  slug      String      @unique @db.VarChar(255)
  type      ContextType
  content   String
  metadata  Json?
  status    String      @default("draft") @db.VarChar(20)
  authorId  String?
  thumbnail String?     @db.Text
  author    User?       @relation(fields: [authorId], references: [id])

  @@schema("ecommerce")
}

enum CollectionType {
  CAMERA
  LENS
  OTHERS

  @@schema("ecommerce")
}

enum ProductColor {
  BLACK
  WHITE
  GRAY

  @@schema("ecommerce")
}

enum Role {
  USER
  ADMIN

  @@schema("ecommerce")
}

enum ContextType {
  PROMOTION
  ABOUT_ME
  BLOG
  TECHNICAL
  STATIC_PAGE
  JOB

  @@schema("ecommerce")
}

model CartItem {
  id        String   @id @default(cuid())
  userId    String
  productId Int
  quantity  Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@schema("ecommerce")
}

model WishlistItem {
  id        String   @id @default(cuid())
  userId    String
  productId Int
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@schema("ecommerce")
}

model Order {
  id              String        @id @default(cuid())
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  userId          String
  user            User          @relation(fields: [userId], references: [id])
  status          OrderStatus   @default(PENDING)
  totalAmount     Float
  paymentMethod   PaymentMethod
  shippingName    String
  shippingPhone   String
  shippingAddress String
  payOSOrderCode  Float?        @unique // Using Float to support large integers if needed, though PayOS limits are high. JS numbers are doubles.
  items           OrderItem[]

  @@schema("ecommerce")
}

model OrderItem {
  id        String  @id @default(cuid())
  orderId   String
  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productId Int
  product   Product @relation(fields: [productId], references: [id])
  quantity  Int
  price     Float

  @@schema("ecommerce")
}

enum OrderStatus {
  PENDING
  PAID
  SHIPPED
  DELIVERED
  CANCELLED

  @@schema("ecommerce")
}

enum PaymentMethod {
  COD
  MOMO
  PAYOS

  @@schema("ecommerce")
}

model Promotion {
  id          Int      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  title       String
  subtitle    String
  description String
  imageUrl    String
  linkUrl     String
  badge       String
  color       String   @default("from-blue-600 to-indigo-700")
  order       Int      @default(0)
  active      Boolean  @default(true)

  @@schema("ecommerce")
}

model SystemConfig {
  id        Int      @id @default(autoincrement())
  key       String   @unique
  value     String   @db.Text
  type      String   @default("text")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@schema("ecommerce")
}
